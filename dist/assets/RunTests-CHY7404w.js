import{M as ie,u as le,r as c,j as e,T as E,R as U}from"./index-C6eRHT7T.js";import{useNavigate as ce}from"react-router-dom";import{Container as de,Typography as r,Alert as me,Paper as y,Box as n,Grid as x,FormControlLabel as xe,Switch as ue,Button as M,CircularProgress as W,LinearProgress as he,Divider as pe,Card as je,CardContent as ge,TableContainer as be,Table as fe,TableHead as Te,TableRow as F,TableCell as m,TableBody as ye,IconButton as ve,Collapse as Se}from"@mui/material";import Ce from"@mui/icons-material/PlayArrow";import we from"@mui/icons-material/BarChart";import Re from"@mui/icons-material/RestartAlt";import Pe from"@mui/icons-material/KeyboardArrowDown";import Ie from"@mui/icons-material/KeyboardArrowUp";import{C as q,P as Oe,a as Ae,S as Be}from"./ProgressBar-CkRz5_ZY.js";import{S as Ee}from"./SeverityChip-Ddfmp31a.js";import Me from"axios";import"@mui/material/Box";import"@mui/icons-material/Menu";import"@mui/icons-material/Notifications";import"@mui/icons-material/HelpOutline";import"@mui/icons-material/Settings";import"@mui/icons-material/AccountCircle";import"@mui/icons-material/DarkMode";import"@mui/icons-material/Home";import"@mui/icons-material/CheckBox";import"@mui/icons-material/Assessment";import"@mui/icons-material/Info";import"@mui/material/styles";import"@mui/material/CssBaseline";import"@mui/icons-material/CheckCircle";import"@mui/icons-material/Error";import"@mui/icons-material/Help";import"@mui/icons-material/Warning";import"@mui/icons-material/PriorityHigh";const Fe="http://localhost:3001/api",Y=Me.create({baseURL:Fe,headers:{"Content-Type":"application/json"}});Y.interceptors.request.use(i=>{const d=localStorage.getItem("token");return d&&(i.headers.Authorization=`Bearer ${d}`),i},i=>Promise.reject(i));Y.interceptors.response.use(i=>i,i=>{var j,h,b,p;const d={status:((j=i.response)==null?void 0:j.status)||500,message:((b=(h=i.response)==null?void 0:h.data)==null?void 0:b.message)||"Something went wrong",data:((p=i.response)==null?void 0:p.data)||{}};return Promise.reject(d)});const $e=async(i,d,j={})=>{try{await new Promise(a=>setTimeout(a,1e3));const b=Object.values(ie).flat().filter(a=>i.includes(a.id)),p={},l={};for(const a of b){await new Promise(v=>setTimeout(v,Math.random()*500+200));const u=Math.random()>.3,g=u?Math.random()*.3+.7:Math.random()*.5+.2,R=u?[]:["Improve model training with more diverse data.","Consider fine-tuning the model parameters.","Add more test cases to validation set."];p[a.id]={test:a,result:{pass:u,score:g,message:`Test ${u?"passed":"failed"} with score ${(g*100).toFixed(1)}%`,metrics:{score:g,evaluated_inputs:Math.floor(Math.random()*100)+50,processing_time:Math.random()*5+.5},details:{tested_with:j[a.id]||{},timestamp:new Date().toISOString()},recommendations:R,timestamp:new Date().toISOString()}},l[a.category]||(l[a.category]={passed:0,total:0}),l[a.category].total+=1,u&&(l[a.category].passed+=1)}return Promise.resolve({results:p,complianceScores:l})}catch(h){return Promise.reject(h)}},mt=()=>{const i=ce(),{selectedTests:d,testParameters:j,modelAdapter:h,modelType:b,saveTestResults:p}=le(),[l,a]=c.useState(!1),[u,g]=c.useState(0),[R,v]=c.useState(""),[J,$]=c.useState({}),[Q,L]=c.useState({}),[X,k]=c.useState(0),[Z,_]=c.useState(0),[P,ee]=c.useState(0),[z,D]=c.useState(!1),[G,N]=c.useState({}),[S,te]=c.useState(!1),[I,V]=c.useState([]),C=c.useRef(null),se=()=>{const t={};return Object.entries(E).forEach(([s])=>{const o=d.filter(w=>{const f=Object.values(MOCK_TESTS).flat().find(A=>A.id===w);return f&&f.category===s});o.length>0&&(t[s]=o.length)}),t};c.useEffect(()=>{C.current&&S&&(C.current.scrollTop=C.current.scrollHeight)},[I,S]);const O=t=>{const s=new Date().toLocaleTimeString();V(o=>[...o,`[${s}] ${t}`])},K=async()=>{if(d.length){a(!0),g(0),v(""),$({}),L({}),k(0),_(0),D(!1),V([]),N({});try{O(`Starting test run for ${d.length} tests...`);const{results:t,complianceScores:s}=await $e(d,h,j);$(t),L(s);const o=Object.values(t).filter(T=>T.result.pass).length,w=d.length-o;k(o),_(w);const H=Object.values(s).reduce((T,B)=>T+B.passed,0),f=Object.values(s).reduce((T,B)=>T+B.total,0),A=f>0?H/f*100:0;ee(A),p(t,s),v(""),a(!1),D(!0),g(100),O(`Test run completed successfully. ${o} passed, ${w} failed.`)}catch(t){console.error("Error running tests:",t),O(`Error running tests: ${t.message}`),a(!1)}}},re=t=>{N(s=>({...s,[t]:!s[t]}))},ne=()=>{i("/results")},oe=t=>typeof t=="number"?t.toFixed(2):t,ae=({item:t})=>e.jsxs(U.Fragment,{children:[e.jsxs(F,{sx:{"& > *":{borderBottom:"unset"}},children:[e.jsx(m,{children:e.jsx(ve,{"aria-label":"expand row",size:"small",onClick:()=>re(t.test.id),children:G[t.test.id]?e.jsx(Ie,{}):e.jsx(Pe,{})})}),e.jsx(m,{component:"th",scope:"row",children:t.test.name}),e.jsx(m,{children:e.jsx(Ae,{category:t.test.category})}),e.jsx(m,{children:e.jsx(Ee,{severity:t.test.severity})}),e.jsx(m,{children:e.jsx(Be,{status:t.result.pass?"passed":"failed"})}),e.jsx(m,{align:"right",children:e.jsx(q,{score:t.result.score*100,size:36,showPercent:!1})})]}),e.jsx(F,{children:e.jsx(m,{style:{paddingBottom:0,paddingTop:0},colSpan:6,children:e.jsx(Se,{in:G[t.test.id],timeout:"auto",unmountOnExit:!0,children:e.jsxs(n,{sx:{margin:1,py:2},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,component:"div",children:"Test Details"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"body2",color:"textSecondary",children:t.test.description}),t.result.metrics&&e.jsxs(n,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Metrics"}),e.jsx(n,{component:"dl",sx:{display:"grid",gridTemplateColumns:"auto 1fr",rowGap:"4px",columnGap:"8px"},children:Object.entries(t.result.metrics).map(([s,o])=>e.jsxs(U.Fragment,{children:[e.jsxs(n,{component:"dt",sx:{fontWeight:"bold",color:"text.secondary"},children:[s.replace(/_/g," "),":"]}),e.jsx(n,{component:"dd",sx:{m:0},children:oe(o)})]},s))})]})]}),e.jsx(x,{item:!0,xs:12,md:6,children:t.result.recommendations&&t.result.recommendations.length>0&&e.jsxs(n,{children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Recommendations"}),e.jsx(n,{component:"ul",sx:{m:0,pl:2,"& li":{mb:1}},children:t.result.recommendations.map((s,o)=>e.jsx("li",{children:e.jsx(r,{variant:"body2",children:s})},o))})]})})]})]})})})})]});return e.jsxs(de,{maxWidth:"lg",children:[e.jsx(r,{variant:"h4",gutterBottom:!0,children:"Run Compliance Tests"}),d.length===0?e.jsx(me,{severity:"warning",sx:{mb:3},children:"No tests have been selected. Please go back to Test Configuration to select tests."}):e.jsxs(y,{sx:{p:3,mb:3},children:[e.jsxs(n,{sx:{mb:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Test Summary"}),e.jsx(x,{container:!0,spacing:2,children:Object.entries(se()).map(([t,s])=>e.jsx(x,{item:!0,xs:6,sm:4,md:3,children:e.jsxs(y,{elevation:0,sx:{p:2,bgcolor:"rgba(0,0,0,0.03)",borderRadius:2,border:"1px solid rgba(0,0,0,0.08)"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(n,{sx:{width:10,height:10,borderRadius:"50%",bgcolor:E[t]||"#757575",mr:1}}),e.jsx(r,{variant:"body2",children:t})]}),e.jsx(r,{variant:"h5",sx:{mt:1,fontWeight:"medium"},children:s})]})},t))})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(xe,{control:e.jsx(ue,{checked:S,onChange:t=>te(t.target.checked),disabled:l}),label:"Verbose Logging"}),e.jsx(M,{variant:"contained",color:"primary",startIcon:l?e.jsx(W,{size:20,color:"inherit"}):e.jsx(Ce,{}),onClick:K,disabled:l,children:l?"Running Tests...":"Run Tests"})]}),(l||z)&&e.jsxs(n,{sx:{mb:3},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(r,{variant:"body2",children:l?`Running: ${R}`:"Test Run Completed"}),e.jsxs(r,{variant:"body2",children:[Math.round(u),"%"]})]}),e.jsx(he,{variant:"determinate",value:u,sx:{height:10,borderRadius:1}})]}),S&&(I.length>0||l)&&e.jsxs(n,{ref:C,sx:{maxHeight:200,overflowY:"auto",p:2,bgcolor:"rgba(0,0,0,0.03)",borderRadius:1,fontFamily:"monospace",fontSize:13,mb:2},children:[I.map((t,s)=>e.jsx(n,{sx:{mb:.5},children:t},s)),l&&e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(W,{size:14,sx:{mr:1}}),"Processing..."]})]}),z&&e.jsxs(e.Fragment,{children:[e.jsx(pe,{sx:{my:3}}),e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Test Results Summary"}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsxs(y,{sx:{p:2,textAlign:"center"},children:[e.jsx(r,{variant:"body2",color:"textSecondary",children:"Total Tests"}),e.jsx(r,{variant:"h4",children:d.length})]})}),e.jsx(x,{item:!0,xs:6,sm:4,children:e.jsxs(y,{sx:{p:2,textAlign:"center",bgcolor:"rgba(76, 175, 80, 0.1)"},children:[e.jsx(r,{variant:"body2",color:"success.main",children:"Tests Passed"}),e.jsx(r,{variant:"h4",color:"success.main",children:X})]})}),e.jsx(x,{item:!0,xs:6,sm:4,children:e.jsxs(y,{sx:{p:2,textAlign:"center",bgcolor:"rgba(244, 67, 54, 0.1)"},children:[e.jsx(r,{variant:"body2",color:"error.main",children:"Tests Failed"}),e.jsx(r,{variant:"h4",color:"error.main",children:Z})]})})]}),e.jsxs(n,{sx:{mt:3,p:3,borderRadius:2,bgcolor:"rgba(0,0,0,0.03)",textAlign:"center"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Overall Compliance Score"}),e.jsx(q,{score:P,size:120,label:P>=80?"Excellent compliance level":P>=50?"Moderate compliance level":"Low compliance level",sx:{mb:1}})]}),e.jsx(r,{variant:"h6",sx:{mt:4,mb:2},children:"Results by Category"}),e.jsx(x,{container:!0,spacing:3,children:Object.entries(Q).map(([t,s])=>{const o=s.total>0?s.passed/s.total*100:0;return e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(je,{children:e.jsxs(ge,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(n,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:E[t]||"#757575",mr:1}}),e.jsx(r,{variant:"subtitle1",children:t})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(r,{variant:"body2",color:"textSecondary",children:["Passed: ",s.passed,"/",s.total]}),e.jsxs(r,{variant:"h6",sx:{color:o>=80?"success.main":o>=50?"warning.main":"error.main"},children:[o.toFixed(1),"%"]})]}),e.jsx(Oe,{value:o,sx:{mt:1}})]})})},t)})}),e.jsx(r,{variant:"h6",sx:{mt:4,mb:2},children:"Detailed Test Results"}),e.jsx(be,{children:e.jsxs(fe,{"aria-label":"test results table",children:[e.jsx(Te,{children:e.jsxs(F,{children:[e.jsx(m,{width:50}),e.jsx(m,{children:"Test Name"}),e.jsx(m,{width:140,children:"Category"}),e.jsx(m,{width:100,children:"Severity"}),e.jsx(m,{width:100,children:"Status"}),e.jsx(m,{width:80,align:"right",children:"Score"})]})}),e.jsx(ye,{children:Object.values(J).map(t=>e.jsx(ae,{item:t},t.test.id))})]})}),e.jsxs(n,{sx:{mt:3,display:"flex",justifyContent:"space-between"},children:[e.jsx(M,{variant:"outlined",startIcon:e.jsx(Re,{}),onClick:K,children:"Run Tests Again"}),e.jsx(M,{variant:"contained",color:"primary",startIcon:e.jsx(we,{}),onClick:ne,children:"View Complete Results"})]})]})]})]})};export{mt as default};
//# sourceMappingURL=RunTests-CHY7404w.js.map
